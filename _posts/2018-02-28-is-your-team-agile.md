---
layout: post
title: "审视敏捷"
description: ""
category: 
tags: []
---
{% include JB/setup %}

当我们说到敏捷转型时，通常大家会想到需要转型的团队一定是有陈旧的技术栈；混乱的技术架构，软件系统各个模块有错综复杂的依赖关系，或者根本没有分明确的模块，就是复杂的一大团；人员结构不符合敏捷团队特征，部门间隔阂严重，职责分化；需求，开发，测试，部署过程有沉重的流程控制。

但是，如果你的项目团队不是上述那种情况，就是敏捷的吗？

比如最近做的一个敏捷转型项目，其旨在分析产品线上收集到的的实时数据做线路策略调整，以减少浪费，节约成本。其背后有数学科学家团队对数据模型的分析评估，产品分析团队实时与用户沟通，得到的反馈实时告知在同一个办公室的开发人员并快速做出修改，并可直接上线。产品经理和团队在同一个开放办公室，有任何问题会实时沟通，产品经理们每天会对产品进行评估分析，定期对新策略结果进行分析并直接反应在开发的任务栏里。这样的团队和项目貌似已经敏捷了。

然而，做完敏捷成熟度评估，发现做到敏捷还有很长的路要走。

#### **首先，在需求管理和人员协作上。**

开发的需求来自至少三个地方，无法将所有的需求整体管理，导致所有需求的优先级不明确，于是无法在人员和时间有限的情况下最快速创造出最需要的价值，当花时间在不恰当的需求开发上时，看似有成果产出，但也造成了人员浪费。看似简单的KANBAN Backlog在有形和无形中起着关键的作用。

当Product owner或客户不按计划出牌怎么办？在IPM完成后有新的需求要求被完成，很多项目特别是试验性项目中很容易出现如此状况。这种现象并非不好，敏捷本身就是要快速响应变化。一个可行方案是评估新加需求的大小和相对计划中任务的优先级，移除最低优先级的与新加需求相近点数的任务卡片。当然在这个过程中需要有效清晰地和需求提出方沟通解释以避免不必要的阻力。

有时需求优先级很清晰仍然会有高优先级的任务搁置，低优先级的却在进行中的现象，也非团队不愿避免，可能是心有余而力不足。开发分为不同小团队，每人或每几人各专一部分，互相之间稍有了解，但是不能互相帮助完成开发，这是常见现象，但也是导致上述问题的原因。不是要求团队成员都是全才，专业侧重没问题而且有必要，但是需要能够协同开发才能避免不必要的浪费，至少同一个产品的团队开发成员需要做到。侧重某一方面或模块的人员作为此模块的专家，做全局和质量把控和难点解决，包括模块间的集成。

同样造成人员时间浪费的还有一个人同时工作在多个任务上。开发人员的context切换是很大的隐性浪费，每一次切换到另外一个任务都需要大脑抽出当前任务，了解或回忆起另一个任务的上下文。大部分开发人员应该有同感，要达到开发的高效状态，就要一个完整的时间段专注在一件事情上。结对编程在一定程度上也起到了避免这种浪费的作用。每个人或者每对pair在KANBAN或类KANBAN的任务管理版面上只负责一张卡片，在一起完成后，再拿另一个需要完成的任务才能够达到按优先级顺序高效地提供价值的目的。

但有时context切换无可避免。当Kickoff后的任务卡片有任何的需求改动需要实时告知相关人员特别是开发人员以尽可能减少浪费，紧急线上产品问题也需要开发人员的及时介入。敏捷认为实时的人员沟通高于清晰完整的文档，并不意味着完全不需要文档，比如承载需求上线文的任务卡片就是必不可少的，需求的关键信息需要准确无误地记录。因为虽然可以和需求方实时沟通，但是沟通后仍然需要反复追加更改或者澄清信息的现象相信任何团队都不期望发生，这也是为什么说Kickoff是最后一次完整地统一需求理解的时机。

避免不必要的上下文切换并避免任务卡在分析，开发和测试间反复跳动的现象，标准的kickoff和deskcheck功不可没。Kickoff要求相关人员在任务被开发前对需求理解完整并一致，侧面上也鞭策了BA，QA和DEV认真理解需求及其要达到的价值并讨论补充可能不清晰或漏掉的场景或细节。一定意义上也可避免大家对任务完成的标准不明确，导致任务卡片在各状态间来回跳动的现象。Deskcheck进一步验证开发前统一期望的价值确实完备无误地被完成。有团队成员说他们在到开发环节前有沟通需求，只是没有做标准的kickoff，开发完成后产品分析人员或产品经理也会看一下再上线，kickoff和deskcheck的形式不重要。但是我要说，仪式感有时很重要，当它成为一种习惯，不必要的疏忽才能避免。试验性项目的需求管理相对复杂，在开发完成前无法明确期望的结果是什么，特别是细节，比如新建的模型是否是更优模型。这种项目的Acceptance Criteria和Kickoff的关注点就应该是业务价值或要达到的目标而非最终呈现的结果如页面上的表象。

#### **其次，在基础设施搭建和技术流程上。**

其中一个代码库无版本控制工具。版本控制工具被普遍使用的今天，你可能会想怎么会有人不使用它。其实是有合理原因的，充分体现了各个现实项目情况的错综复杂。其一，代码源头有二，正常的代码修改和从spotfire（一个可编码的数据分析工具）中反向generate出来的，而且多数时候需要修改的代码需要在spotfire中呈现并分析后才可判断是否正确并提交；其二，主要代码为pl sql，直接导入数据库，修改和管理代码方便快捷；其三，只有两人左右在维护一个代码库，每天改动代码量也不大，联合调试没有很痛苦。 

然而，没有版本控制工具的痛点也清晰可见。部署前需要手动剥离用来测试的代码和真正的产品代码，从一堆可能是别人开发的或是工具generate出来的，完全不清楚或记不清楚的，时间可能已经久远的错综关联的代码中挑出需要上线的代码是一件非常危险和令人抓狂的事情。代码冲突可能不多，但是仍可能发生互相覆盖。以命名做版本控制，完成后直接覆盖另一版本导致直接无法看到真正的改动及其历史和目的。项目还需多个版本需要同时维护，各种文件命名将代码库搞得混乱不堪。与其相关的还有所有人共用一个测试环境的问题，没有唯一的代码库，即使有其他环境，也无法保证每个环境的代码一致，更无需谈控制不同环境用可控的版本。这些痛点让产品质量像在钢丝上。

无法容忍这些痛点就只能解决应用版本控制工具的难点，包括一个测试数据库需要T级别。软件开发有时确实像在博弈，时刻都在权衡。

所有人共用一个测试环境自然就无法做自动化测试，即使开发人员不抱怨测试环境为什么总是不稳定，测试人员也会头疼为什么正在测试的功能突然就不工作了。无自动化测试就导致无法保证上线后所有的已有功能完好无损，测试人员需要重复地完成相同场景的测试。自然，也就没有TDD。完整合理的测试策略，看似很简单的事，却可以作为一把尺子，帮助度量从开发到上线整个过程中对质量的关卡是否有缺失或漏洞。试想，如果最初团队就定下测试策略，拟定何时何人需要做何种类型的测试，单元测试，集成测试，契约测试，安全测试，自动化或是手工测试，TDD和自动化测试自然就会有，测试环境也会在项目开始时就就绪。

关于持续集成开发和持续部署，相信大部分人已经了解，这里唯一想要说的是不要只局限于形式，只是有这些基础设施的搭建，重要的是能够要起到CI和CD的作用。比如，CI上运行的自动化测试是否能反应项目的健康状况，主要的业务线逻辑和功能是否被测试覆盖才是CI的关键。对于一直缺失自动化测试的项目来说，做到这一点会比较难，但亡羊补牢，为时未晚，当项目越来越大，CI的作用会体现得更加明显和频繁。测试覆盖率也是TDD能带来的好处之一。

#### **那些质疑**

说到TDD，会有一些争议，一是花的时间长，用TDD会比直接写实现代码多一倍的时间。当不熟悉TDD开发方式，或者用错误的先测试再开发的方式确实是会花更多的时间。毕竟，至少多了写测试的时间。但是，TDD的设定是帮助设计代码并一定程度上协助理清思路，关注在真正需要的需求上，避免不必要的过度设计造成的僵尸代码，也可帮助避免遗漏需涵盖的业务场景。所以，当能够领会TDD的用法和目的后，就不会陷在该测过程还是结果，测试粒度到底该多大的讨论泥潭里了。这就需要多练，无论是做coding kata还是在产品代码中实战。二是单元测试没意义。当你在纠结这个问题时，可能需要看一下被测的产品代码是否是主要业务逻辑，如果主要业务代码还没有测试覆盖，而花了很多时间为边角的代码补写测试就很容易造成单元测试无意义的假象。写单元测试也要从业务意义出发，如果专注于实现细节的测试，测试代码是否通过无法反应业务逻辑是否正确，这样的单元测试确实没意义。对于没有使用TDD甚至没有测试的遗留系统，新代码量不大但需要补写的自动化测试数量特别大，个人认为可以先理出主业务线，在一条完整的功能测试基础上添加单元测试来覆盖分支逻辑，可以更快体现自动化测试的作用，也可辅助单元测试的添加，毕竟，后期添加单元测试的代码通常都需要重构。

同样遭受到质疑的还有结对编程，有人会觉得浪费时间，在制品数量减半，导致团队吞吐量（throughput）降低。但恰当的结对编程可以降低和吞吐量成反比的lead time，是项目的质量闸门之一，也推进了团队成员间的信息和能力交流，变相地提高吞吐量，也一定程度上减少专人只能做专任务导致高优先级任务无法全员推进的现象。

所以，测试策略，TDD和结对编程等小的实践的价值并非只是它们本身的体现，其背后也可延伸和发现多个项目中可能存在的问题。也会收到意外之喜，比如更加积极主动的团队成员甚至自组织团队。但收效相较缓慢，很难被初接触敏捷实践的团队接受。这就需要对敏捷理解更深的团队成员的坚持和不断引导分享，用习惯力量继续下去。

这个时候就需要规律地投入时间。有人抱怨说加入敏捷实践后，需要投入的时间增加了，这是必然的。当不熟悉敏捷时，学习是要花大量时间的。学习的过程一定是痛苦的，团队需要有人组织规律时间的学习训练；在敏捷实践理解不深，应用不熟的情况下很容易在外部压力下放弃，这时需要有人在项目中出现千变万化的问题，特别是针对敏捷实践的挑战或阻力时，找到合适的应对措施坚持必须的实践，这些人就是我们培养的内部教练。

#### **最后**

敏捷不只是快，更重要的是高质量地产出正确的产品。敏捷之所以被推崇和应用，但很多团队无法做到真正的敏捷，个人认为是在实际项目中千变万化的问题和压力无法被找到敏捷的方法，敏捷方法多样，在什么团队什么情况什么实践是必须有如何做也不同。Be agile而非do agile是关键。

你的团队如何呢？是否在交付压力下放弃了必要的敏捷实践？私认为敏捷实践之一就是不断审视自己所在的项目和团队，无论你的项目是以敏捷的方式创建的，还是后来转型成功的。细节决定成败。

